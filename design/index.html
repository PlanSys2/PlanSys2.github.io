

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>PlanSys2 design &mdash; ROS2 Planning System 2 1.0.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/plansys2_48x48.png"/>
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tutorials" href="../tutorials/index.html" />
    <link rel="prev" title="Getting Started" href="../getting_started/index.html" />

<link rel="stylesheet" href="../_static/tcs_theme.css" type="text/css" />


</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: orange" >
          

          
            <a href="../index.html" class="icon icon-home"> ROS2 Planning System 2
          

          
            
            <img src="../_static/plansys2_logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                latest
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting_started/index.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/index.html#installation">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../getting_started/index.html#running-the-example">Running the Example</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">PlanSys2 design</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#domain-expert">1. Domain Expert</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#parameters">Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#client-api">Client API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#services">Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="#publishers-subscriber">Publishers / Subscriber</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#problem-expert">2. Problem Expert</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Client API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">Publishers / Subscriber</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#planner">3. Planner</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id6">Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id7">Client API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">Services</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id9">Publishers / Subscriber</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#executor">4. Executor</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id10">Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">Client API</a></li>
<li class="toctree-l3"><a class="reference internal" href="#actions">Actions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id12">Publishers / Subscriber</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#behavior-tree-builder">Behavior Tree builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="#action-delivery-protocol">Action delivery protocol</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id13">Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id14">Publishers / Subscriber</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/docs/terminal_usage.html">Terminal Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/docs/terminal_usage.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/docs/terminal_usage.html#tutorial-steps">Tutorial Steps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/docs/terminal_usage.html#requisites">0- Requisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/docs/terminal_usage.html#launch-plansys2">1- Launch PlanSys2</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/docs/terminal_usage.html#execute-plansys2-terminal">2- Execute PlanSys2 terminal</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/docs/terminal_usage.html#interactive-session">2- Interactive session</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/docs/simple_example.html">The first planning package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/docs/simple_example.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/docs/simple_example.html#tutorial-steps">Tutorial Steps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/docs/simple_example.html#requisites">0- Requisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/docs/simple_example.html#running-the-example">1- Running the example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/docs/simple_example.html#package-structure">2- Package structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/docs/simple_example.html#actions-implementation">3- Actions implementation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/docs/simple_example.html#launcher">4- Launcher</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/docs/controller_example.html">Using a planning controller</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/docs/controller_example.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/docs/controller_example.html#tutorial-steps">Tutorial Steps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/docs/controller_example.html#requisites">0- Requisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/docs/controller_example.html#running-the-example">1- Running the example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/docs/controller_example.html#patrol-action-performer">2- Patrol action performer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/docs/controller_example.html#move-action-performer">3- Move action performer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/docs/controller_example.html#mission-controller">3- Mission controller</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/docs/controller_example.html#running-the-example-with-nav2">4- Running the example with Nav2</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/docs/bt_actions.html">Implement actions as Behavior Trees</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/docs/bt_actions.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorials/docs/bt_actions.html#tutorial-steps">Tutorial Steps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/docs/bt_actions.html#requisites">0- Requisites</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/docs/bt_actions.html#running-the-example">1- Running the example</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tutorials/docs/bt_actions.html#using-behavior-trees">2- Using Behavior Trees</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About and Contact</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about/index.html#id1">About</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/index.html#contact">Contact</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">ROS2 Planning System 2</a>
        
      </nav>


      <div class="wy-nav-content">

<span style="float: right;" >
    <a class="github-button" href="https://github.com/IntelligentRoboticsLabs/ros2_planning_system.github.io" data-color-scheme="no-preference: light; light: light; dark: dark;" data-size="large" aria-label="Edit IntelligentRoboticsLabs/ros2_planning_system.github.io on GitHub" ">Edit</a>
</span>


        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>PlanSys2 design</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="plansys2-design">
<span id="design"></span><h1>PlanSys2 design<a class="headerlink" href="#plansys2-design" title="Permalink to this headline">¶</a></h1>
<a class="reference internal image-reference" href="../_images/plansys2_arch.png"><img alt="../_images/plansys2_arch.png" class="align-center" src="../_images/plansys2_arch.png" style="width: 800px;" /></a>
<p>PlanSys2 has a modular design. It is basically composed of 4 nodes:</p>
<ul class="simple">
<li><p><strong>Domain Expert</strong>: Contains the PDDL model information (types, predicates model, and actions).</p></li>
<li><p><strong>Problem Expert</strong>: Contains the current instances, predicates, and goals that compose the model.</p></li>
<li><p><strong>Planner</strong>: Generates plans (sequence of actions) using the information contained in the Domain and Problem Experts.</p></li>
<li><p><strong>Executor</strong>: Takes a plan and executes it by activatin the <em>action performers</em> (the ROS2 nodes that implement each action).</p></li>
</ul>
<p>Each of these nodes exposes its functionality using ROS2 services. Even so, in PlanSys2 we have created a client library that can be used in
any application and hides the complexity of using ROS2 services.</p>
<a class="reference internal image-reference" href="../_images/plansys2_clients.png"><img alt="../_images/plansys2_clients.png" class="align-center" src="../_images/plansys2_clients.png" style="width: 500px;" /></a>
<div class="section" id="domain-expert">
<h2>1. Domain Expert<a class="headerlink" href="#domain-expert" title="Permalink to this headline">¶</a></h2>
<p>The objective of the Model Expert is to read PDDL domains from files and make them available to the rest of the components. It’s static (by now).</p>
<div class="section" id="parameters">
<h3>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">model_file</span></code> [string]: PDDL model files to load, separates by “:”. These models will be merged. This lets to have a modular application in which each component/package contributes with part of the PDDL and the action implementation. See <a class="reference external" href="https://github.com/IntelligentRoboticsLabs/ros2_planning_system_examples/tree/master/plansys2_multidomain_example">plansys2_multidomain_example</a> for more details.</p></li>
</ul>
</div>
<div class="section" id="client-api">
<h3>Client API<a class="headerlink" href="#client-api" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">getTypes</span><span class="p">()</span>

<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">getPredicates</span><span class="p">()</span>
<span class="n">boost</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">plansys2</span><span class="o">::</span><span class="n">Predicate</span><span class="o">&gt;</span> <span class="n">getPredicate</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span> <span class="n">predicate</span><span class="p">)</span>

<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">getActions</span><span class="p">()</span>
<span class="n">boost</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">plansys2</span><span class="o">::</span><span class="n">Action</span><span class="o">&gt;</span> <span class="n">getAction</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span> <span class="n">action</span><span class="p">)</span>

<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">getDurativeActions</span><span class="p">()</span>
<span class="n">boost</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">plansys2</span><span class="o">::</span><span class="n">DurativeAction</span><span class="o">&gt;</span> <span class="n">getDurativeAction</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span> <span class="n">action</span><span class="p">)</span>

<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">getDomain</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="services">
<h3>Services<a class="headerlink" href="#services" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">domain_expert/get_domain_types</span></code> [plansys2_msgs::srv::GetDomainTypes]: Get the valid types.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">domain_expert/get_domain_actions</span></code> [plansys2_msgs::srv::GetDomainActions]: Get the available actions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">domain_expert/get_domain_action_details</span></code> [plansys2_msgs::srv::GetDomainActionDetails]: Get the details of a specific action.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">domain_expert/get_domain_predicates</span></code> [plansys2_msgs::srv::GetDomainPredicates]: Get the valid predicates.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">domain_expert/get_domain_predicate_details</span></code> [plansys2_msgs::srv::GetDomainPredicateDetails]: Get the details of a specific predicate.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">domain_expert/get_domain</span></code> [plansys2_msgs::srv::GetDomain]: Set the domain as a string.</p></li>
</ul>
</div>
<div class="section" id="publishers-subscriber">
<h3>Publishers / Subscriber<a class="headerlink" href="#publishers-subscriber" title="Permalink to this headline">¶</a></h3>
<p>None</p>
</div>
</div>
<div class="section" id="problem-expert">
<h2>2. Problem Expert<a class="headerlink" href="#problem-expert" title="Permalink to this headline">¶</a></h2>
<p>Contains the knowledge of the system: instances, grounded predicates, and goals.</p>
<div class="section" id="id1">
<h3>Parameters<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">model_file</span></code> [string]: PDDL model files to load, separates by “:”. These models will be merged. This lets to have a modular application in which each component/package contributes with part of the PDDL and the action implementation. See <a class="reference external" href="https://github.com/IntelligentRoboticsLabs/ros2_planning_system_examples/tree/master/plansys2_multidomain_example">plansys2_multidomain_example</a> for more details. It must have the same value as in Domain Expert.</p></li>
</ul>
</div>
<div class="section" id="id3">
<h3>Client API<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">&gt;</span> <span class="n">getInstances</span><span class="p">()</span>
<span class="kt">bool</span> <span class="n">addInstance</span><span class="p">(</span><span class="k">const</span> <span class="n">Instance</span> <span class="o">&amp;</span> <span class="n">instance</span><span class="p">)</span>
<span class="kt">bool</span> <span class="n">removeInstance</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span> <span class="n">name</span><span class="p">)</span>
<span class="n">boost</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">Instance</span><span class="o">&gt;</span> <span class="n">getInstance</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span> <span class="n">name</span><span class="p">)</span>

<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Predicate</span><span class="o">&gt;</span> <span class="n">getPredicates</span><span class="p">()</span>
<span class="kt">bool</span> <span class="n">addPredicate</span><span class="p">(</span><span class="k">const</span> <span class="n">Predicate</span> <span class="o">&amp;</span> <span class="n">predicate</span><span class="p">)</span>
<span class="kt">bool</span> <span class="n">removePredicate</span><span class="p">(</span><span class="k">const</span> <span class="n">Predicate</span> <span class="o">&amp;</span> <span class="n">predicate</span><span class="p">)</span>
<span class="kt">bool</span> <span class="n">existPredicate</span><span class="p">(</span><span class="k">const</span> <span class="n">Predicate</span> <span class="o">&amp;</span> <span class="n">predicate</span><span class="p">)</span>

<span class="kt">bool</span> <span class="n">addAssignment</span><span class="p">(</span><span class="k">const</span> <span class="n">Assignment</span> <span class="o">&amp;</span> <span class="n">assignment</span><span class="p">)</span>

<span class="n">Goal</span> <span class="n">getGoal</span><span class="p">()</span>
<span class="kt">bool</span> <span class="n">setGoal</span><span class="p">(</span><span class="k">const</span> <span class="n">Goal</span> <span class="o">&amp;</span> <span class="n">goal</span><span class="p">)</span>
<span class="kt">bool</span> <span class="n">clearGoal</span><span class="p">()</span>

<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">getProblem</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id4">
<h3>Services<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">problem_expert/add_problem_goal</span></code> [plansys2_msgs::srv::AddProblemGoal]: Replace the goal.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">problem_expert/add_problem_assignment</span></code> [plansys2_msgs::srv::AddProblemAssignment]: Add an assignment.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">problem_expert/add_problem_instance</span></code> [plansys2_msgs::srv::AddProblemInstance]: Add an instance.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">problem_expert/add_problem_predicate</span></code> [plansys2_msgs::srv::AddProblemPredicate]: Add a predicate.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">problem_expert/get_problem_goal</span></code> [plansys2_msgs::srv::GetProblemGoal]: Get the current goal.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">problem_expert/get_problem_instance_details</span></code> [plansys2_msgs::srv::GetProblemInstanceDetails]: Get the details of an instance.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">problem_expert/get_problem_instances</span></code> [plansys2_msgs::srv::GetProblemInstances]: Get all the instances.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">problem_expert/get_problem_predicate_details</span> <span class="pre">=</span></code> [plansys2_msgs::srv::GetProblemPredicateDetails]: Get the details of a predicate.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">problem_expert/get_problem_predicates</span></code> [plansys2_msgs::srv::GetProblemPredicates]: Get all the predicates.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">problem_expert/get_problem</span></code> [plansys2_msgs::srv::GetProblem]: Get the PDDL problem as a string.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">problem_expert/remove_problem_goal</span></code> [plansys2_msgs::srv::RemoveProblemGoal]: Remove the current goal.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">problem_expert/remove_problem_instance</span></code> [plansys2_msgs::srv::RemoveProblemInstance]: Remove an instance.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">problem_expert/remove_problem_predicate</span></code> [plansys2_msgs::srv::RemoveProblemPredicate]: remove a predicate.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">problem_expert/exist_problem_predicate</span></code> [plansys2_msgs::srv::ExistProblemPredicate]: Check if a predicate exists.</p></li>
</ul>
</div>
<div class="section" id="id5">
<h3>Publishers / Subscriber<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">problem_expert/update_notify</span></code> [std_msgs::msg::Empty] {Publisher: rclcpp::QoS(100)}: A message is published in this topic when any element of the problem changes.</p></li>
</ul>
</div>
</div>
<div class="section" id="planner">
<h2>3. Planner<a class="headerlink" href="#planner" title="Permalink to this headline">¶</a></h2>
<p>This component calculates the plan to obtain a goal.</p>
<ol class="arabic simple">
<li><p>When requested for a plan, the Planner asks the Planner Expert the domain, and the Problem Expert the problem.</p></li>
<li><p>The domain is stored in <code class="docutils literal notranslate"><span class="pre">/tmp/&lt;node</span> <span class="pre">namespace&gt;/domain.pddl</span></code>. This lets to have several PlanSys2 instances in the same machine, useful for simulating multiple robots in the same machine.</p></li>
<li><p>The problem is stored in <code class="docutils literal notranslate"><span class="pre">/tmp/&lt;node</span> <span class="pre">namespace&gt;/problem.pddl</span></code>.</p></li>
<li><p>Run the PDDL Solver, storing the output in <code class="docutils literal notranslate"><span class="pre">tmp/&lt;node</span> <span class="pre">namespace&gt;/plan.pddl</span></code>.</p></li>
<li><p>Parse <code class="docutils literal notranslate"><span class="pre">tmp/&lt;node</span> <span class="pre">namespace&gt;/plan.pddl</span></code> to get the sequence of actions as a vector of string.</p></li>
<li><p>Return the result.</p></li>
</ol>
<p>Each PDDL solver in PlanSys2 is a plugin. By default PlanSys2 uses <a class="reference external" href="https://github.com/IntelligentRoboticsLabs/ros2_planning_system/tree/master/plansys2_popf_plan_solver">POPF</a>, although other PDDL solvers can be used easily. Right now it is available
<a class="reference external" href="https://github.com/IntelligentRoboticsLabs/plansys2_tfd_plan_solver">Temporal Fast Downward</a> also.</p>
<a class="reference internal image-reference" href="../_images/plansys2_planner.png"><img alt="../_images/plansys2_planner.png" class="align-center" src="../_images/plansys2_planner.png" style="width: 300px;" /></a>
<div class="section" id="id6">
<h3>Parameters<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">plan_solver_plugins</span></code> [vector&lt;string&gt;]: List of PDDL solver plugins. Currently, only the first plugin specified will be used. If not set, POPF will be used by default. Check <a class="reference external" href="https://github.com/IntelligentRoboticsLabs/ros2_planning_system/blob/master/plansys2_bringup/params/plansys2_params.yaml">this config</a> as an example on how to use it.</p></li>
</ul>
</div>
<div class="section" id="id7">
<h3>Client API<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="n">boost</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">Plan</span><span class="o">&gt;</span> <span class="n">getPlan</span><span class="p">()</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id8">
<h3>Services<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">planner/get_plan</span></code> [plansys2_msgs::srv::GetPlan]: Get a plan with the current info in Domain/Problem Expert.</p></li>
</ul>
</div>
<div class="section" id="id9">
<h3>Publishers / Subscriber<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>None</p>
</div>
</div>
<div class="section" id="executor">
<h2>4. Executor<a class="headerlink" href="#executor" title="Permalink to this headline">¶</a></h2>
<p>This component is responsible for requesting a plan and executing it. It is, by far, the most complex component since you must request a plan and execute it by activating the action performers. This task is carried out with the following characteristics:</p>
<ul class="simple">
<li><p>It optimizes its execution, parallelizing the actions when possible.</p></li>
<li><p>Check if the requirements are met at runtime.</p></li>
<li><p>Allow more than one action performer for each action, supporting multirobot execution.</p></li>
</ul>
<a class="reference internal image-reference" href="../_images/plansys2_arch2.png"><img alt="../_images/plansys2_arch2.png" class="align-center" src="../_images/plansys2_arch2.png" style="width: 600px;" /></a>
<div class="section" id="id10">
<h3>Parameters<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>None</p>
</div>
<div class="section" id="id11">
<h3>Client API<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="kt">bool</span> <span class="nf">executePlan</span><span class="p">();</span>

<span class="n">ExecutePlan</span><span class="o">::</span><span class="n">Feedback</span> <span class="n">getFeedBack</span><span class="p">();</span>
<span class="n">boost</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">ExecutePlan</span><span class="o">::</span><span class="n">Result</span><span class="o">&gt;</span> <span class="n">getResult</span><span class="p">();</span>
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="actions">
<h3>Actions<a class="headerlink" href="#actions" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">execute_plan</span></code> [plansys2_msgs::action::ExecutePlan]: Execute the plan with the current info in Domain/Problem Expert.</p></li>
</ul>
</div>
<div class="section" id="id12">
<h3>Publishers / Subscriber<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>None</p>
</div>
</div>
<div class="section" id="behavior-tree-builder">
<h2>Behavior Tree builder<a class="headerlink" href="#behavior-tree-builder" title="Permalink to this headline">¶</a></h2>
<p>Once a plan is obtained, the Executor converts it to a Behavior Tree to execute it. Each action becomes the following subtree:</p>
<a class="reference internal image-reference" href="../_images/action_bt.png"><img alt="../_images/action_bt.png" class="align-center" src="../_images/action_bt.png" style="width: 400px;" /></a>
<p>The first step is building a planning graph that encondes the action dependencies that define the execution order. This is made
by pairing the effects of an action with a requirement of a posterior action. We take as reference the time of the calculated plan:</p>
<a class="reference internal image-reference" href="../_images/action_deps.png"><img alt="../_images/action_deps.png" class="align-center" src="../_images/action_deps.png" style="width: 250px;" /></a>
<a class="reference internal image-reference" href="../_images/plan_graph.png"><img alt="../_images/plan_graph.png" class="align-center" src="../_images/plan_graph.png" style="width: 200px;" /></a>
<p>Once created the graph, we identify the execution flows:</p>
<a class="reference internal image-reference" href="../_images/graph_flows.png"><img alt="../_images/graph_flows.png" class="align-center" src="../_images/graph_flows.png" style="width: 800px;" /></a>
<p>From the red flow, for example, we get:</p>
<a class="reference internal image-reference" href="../_images/red_flow.png"><img alt="../_images/red_flow.png" class="align-center" src="../_images/red_flow.png" style="width: 400px;" /></a>
<p>Each flow is executed in paralell. There is no problem if flows overlap because the BT that executes an action is implemented following a Singleton-like approach.</p>
</div>
<div class="section" id="action-delivery-protocol">
<h2>Action delivery protocol<a class="headerlink" href="#action-delivery-protocol" title="Permalink to this headline">¶</a></h2>
<p>In the first implementations of PlanSys2, the delivery of actions was done using ROS2 actions. This approach has currently been discarded as it is not flexible enough.
Instead, a bidding-based delivery protocol has been developed in the <code class="docutils literal notranslate"><span class="pre">plansys2_msgs::msg::ActionExecution</span></code>,  and classes <code class="docutils literal notranslate"><span class="pre">ActionExecutor</span></code> and <code class="docutils literal notranslate"><span class="pre">ActionExecutoClient</span></code>.</p>
<p>When the Executor must execute an action, it requests which action performer can execute it. Those who can
reply to this request. The Executor confirms one of them (the first to answer), rejecting the rest. If none are found, repeat the request every second until you give up, aborting the
execution of the plan. This protocol uses the topic <code class="docutils literal notranslate"><span class="pre">/action_hub</span></code>, where you can monitorize teh execution of the system.</p>
<a class="reference internal image-reference" href="../_images/protocol.png"><img alt="../_images/protocol.png" class="align-center" src="../_images/protocol.png" style="width: 500px;" /></a>
<p>All the action performers inherit from <code class="docutils literal notranslate"><span class="pre">ActionExecutoClient</span></code>, that is a ROS2 Node with the next information:</p>
<div class="section" id="id13">
<h3>Parameters<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">~/action</span></code> [string]: The action managed. This action performer discard any request non equal to this parameter.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">~/specialized_arguments</span></code> [vector&lt;string&gt;]: If this parameter is not void, it only replies to action request that contains in any of the arguments any of these values.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In a multirobot application, for example, we add to the actions a parameter with the robot that should do the action. In each robot we can execute the same action performer, and using <code class="docutils literal notranslate"><span class="pre">~/specialized_arguments</span></code> we can select which will be executed.</p>
</div>
</div>
<div class="section" id="id14">
<h3>Publishers / Subscriber<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/actions_hub</span></code> [plansys2_msgs::msg::ActionExecution] {Publisher: rclcpp::QoS(100).reliable()}: Receive messages from the Action Hub.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/actions_hub</span></code> [plansys2_msgs::msg::ActionExecution] {Subscriber: rclcpp::QoS(100).reliable()}: Publish messages to the Action Hub.</p></li>
</ul>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020

    </p>
  </div> 

</footer>

        </div>


      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  

<script type="text/javascript" src="../_static/tcs_theme.js"></script>
<script async defer src="https://buttons.github.io/buttons.js"></script>



</body>
</html>